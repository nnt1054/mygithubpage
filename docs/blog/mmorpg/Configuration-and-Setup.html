<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google" content="notranslate" />

  <title>Neil Toledo - Configuration/Setup</title>
  <meta name="description" content="Github">

  <link rel="icon" href="/assets/images/me.jpg">
  <link rel="shortcut icon" href="/assets/images/me.jpg">
  <link rel="apple-touch-icon" href="/assets/images/me.jpg">

  <link rel="stylesheet" href="/assets/css/rouge.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <!--<link href='https://fonts.googleapis.com/css?family=Lexend+Deca' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Livvic' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>-->
  <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
  <link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet'>
</head>

  <body>
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

    <link rel="stylesheet" href="/assets/css/documentation.css">

    <div id='top-nav-container'>

	<div id='nav-left'>
		<a href='/' class='img-container'> <img id="home-img" src="/assets/images/me.jpg"> </a>
		<h1> 2DMMORPG Documentation </h1>
	</div> 

	<div id='nav-right'>
		<a class="rect-btn" href="/portfolio"> <span>portfolio</span> </a>
		<a class="rect-btn" href="/blog/projects"> <span>blog</span> </a>
		<a class="rect-btn" href="/assets/images/resume.pdf"> <span>resume</span> </a>
	</div>

</div>

<style>

	#top-nav-container {
		display: flex;
		flex-direction: row;

		justify-content: space-between;

	 	max-width: 1280px;
		width: 80vw;

		position: absolute;
		margin: 0px auto;
		top: 32px;
		left: 0px;
		right: 0px;
	}

	#home-img {
		height: 64px;
		width: 64px;
		border-radius: 50%;
		border: 2px black solid;
	}

	#nav-left, #nav-right {
		display: flex;
		flex-direction: row;
	}

	#nav-left > * {
		margin-top: auto;
		margin-bottom: auto;
	}

	#nav-right > * {
		margin-top: auto;
		margin-bottom: auto;
	}

	#nav-left > h1 {
		margin-left: 12px;
		cursor: default;
	}

	.sm-link {
		font-size: 10pt;
		padding: 6px 8px;
	}

	.img-container {
		display: flex;
	}

	.rect-btn {
		width: 128px;
		margin-left: 10px;
		margin-right: 10px;
		border: 2px solid black;
		border-radius: 6px;
		background: white;
		box-shadow: 5px 5px;
		transform: translateY(-5px) translateX(-5px);
		cursor: pointer;
		height: 32px;
		display: flex;
		z-index: 10;
		color: black;
	}

	.rect-btn:hover {
		transition: 0.1s;
		box-shadow: 2px 2px;
		transform: translateY(-2px) translateX(-2px);
		text-decoration: none;
	}
	
	.rect-btn > * {
		margin: auto;
	}


@media (max-width: 1024px) {
	#top-nav-container {
		position: absolute;
	}

	#nav-right {
		display: none;
	}

}

</style>

    <div id="page-container">

        <div id="nav-container">
            <span> Pages </span>
            <ul class='nav-page-list'>

                

                

                

                <!-- get posts without parent -->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <a href="/blog/mmorpg/mmorpg-project-overview"> • Project Overview </a>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <a href="/blog/mmorpg/General-Architecture"> • General Architecture </a>
                    
                
                    
                        <a href="/blog/mmorpg/Scrum-Board"> • Scrum Board [WIP] </a>
                    
                

                <!-- get posts with parent tag -->
                
                    
                    

                    

                    
                    <span> Component Design Documents </span>
                    <ul class='nav-page-list'>
                    
                        
                    
                        
                            <a href="/blog/mmorpg/Game-Client"> • Game Client </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Primary-Gateway-Server"> • Primary Gateway Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Server-Manager"> • Server Manager </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Game-Server-Instance"> • Game Server Instance </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Social-Services-Server"> • Social API Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Account-Data-API"> • Account Data API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Character-Data-API"> • Character Data API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Questing-API"> • Questing API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/CDN-Asset-Server"> • CDN Asset Server </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                
                    
                    

                    

                    
                    <span> Game Design Documents </span>
                    <ul class='nav-page-list'>
                    
                        
                            <a href="/blog/mmorpg/Game-Design-Overview"> • Game Design Overview </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                
                    
                    

                    

                    
                    <span> CI/CD and Infrastructure </span>
                    <ul class='nav-page-list'>
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            <a href="/blog/mmorpg/CICD-Overview"> • Overview </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Configuration-and-Setup"> • Configuration/Setup </a>
                        
                    
                        
                    
                        
                            <a href="/blog/mmorpg/Polling-Server"> • Polling Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Helm-API"> • Helm API </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                


            </ul>
            
        </div>

        <div id="page-content" itemprop="articleBody">
            <header class="post-header">
                <h1 class="post-title" itemprop="name headline">Configuration/Setup</h1>
                <p class="post-meta"><time datetime="2020-04-28T00:00:00-07:00" itemprop="datePublished">Apr 28, 2020</time></p>
            </header>
            <p><a href="https://github.com/nnt1054/mmorpg-cicd">Github</a></p>

<h3 id="introduction">Introduction</h3>

<p>This section of the documentation outlines the directory structure of the cicd resources and explains which values need to be configured for a deployment.  Afterwards, we outline step by step on how to deploy the cicd system and describe which/what resources are deployed on which clusters.</p>

<h3 id="cicd-directory-structure">CI/CD Directory Structure</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="s">"""
.
├── chartmuseum/
|   ├── values.yaml
├── docker-registry/
|   ├── values.yaml
├── minio/
|   ├── values.yaml
├── ingress-master/
|   ├── values.yaml
├── helm-api/
|   ├── charts/
|   ├── templates/
|	|   ├── configmap.yaml
|   |	└── helmsman-cronjob.yaml
|   ├── helmsman/
|   |	└── kubeconfig
|   ├── Chart.yaml
|   └── values.yaml
├── polling-server/
|   ├── charts/
|   ├── templates/
|	|   └── configmap.yaml
|   ├── Chart.yaml
|   └── values.yaml
├── cicd_storage_dss.yaml
├── cicd_tools_dss.yaml
├── applications/
|   ├── application-prod.yaml
|   ├── application-staging.yaml
|   └── application-staging.yaml
"""</span></code></pre></figure>

<h4 id="configuration">Configuration:</h4>
<ul>
  <li>update the ingress.host.name and ingress.host.path values for each values.yaml file except for the helm-api.</li>
  <li>specify the cluster.context value in helm-api values.yaml file</li>
  <li>list the application pipelines and helm pipelines in the polling-server values.yaml file</li>
  <li>specify the cluster context for the cicd dss files</li>
  <li>include any new value files into the application sections of the helmsman dss files</li>
</ul>

<h3 id="example-application-directory-structure">Example Application Directory Structure</h3>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="s">"""
.
├── helm/
|   ├── chart/
|   └── values/
|	|   ├── dev_values.yaml
|	|   ├── prod_values.yaml
|   |	└── staging_values.yaml
├── Dockerfile
├── node_modules/
├── index.js
└── package.json.yaml
"""</span></code></pre></figure>

<h4 id="notes">Notes:</h4>
<ul>
  <li><a href="https://github.com/nnt1054/mmorpg-test-service">Example Test Service</a></li>
  <li>in an effort to give ownership of the application helm charts back to the developers, as opposed to being managed by a SRE/DevOps team, we’re storing each applications helm charts and value files within their respective github repositories. These helm charts will be uploaded to the chartmuseum repository (via helm-push) and be accessed from there by the helmsman dss files.  The value files for the helm chart will be referenced by helmsman using their raw github url link.</li>
  <li>the Dockerfile must be in the top level directory of the repo, since the polling-server calls <code class="highlighter-rouge">docker build</code> using the github repo URL.</li>
</ul>

<h3 id="setup">Setup</h3>

<h4 id="setting-up-cicd-cluster">Setting up CICD Cluster</h4>
<ol>
  <li><code class="highlighter-rouge">git clone https://github.com/nnt1054/mmorpg_cicd.git &amp;&amp; cd mmorpg_cicd</code></li>
  <li><code class="highlighter-rouge">minikube start --profile cicd &amp;&amp; minikube profile cicd</code></li>
  <li>create helmsman service account
    <ul>
      <li><code class="highlighter-rouge">kubectl create sa helmsman</code></li>
      <li><code class="highlighter-rouge">kubectl create clusterrolebinding helmsman-cluster-admin --clusterrole=cluster-admin --serviceaccount=default:helmsman</code></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">helmsman --apply -f cicd_storage_dss.yaml</code></li>
</ol>

<h4 id="setting-up-the-application-cluster">Setting up the Application Cluster</h4>
<ol>
  <li><code class="highlighter-rouge">minikube --profile app &amp;&amp; minikube profile app</code></li>
  <li>create helmsman service account
    <ul>
      <li><code class="highlighter-rouge">kubectl create sa helmsman</code></li>
      <li><code class="highlighter-rouge">kubectl create clusterrolebinding helmsman-cluster-admin --clusterrole=cluster-admin --serviceaccount=default:helmsman</code></li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">helmsman --apply -f cicd_tools_dss.yaml</code></li>
  <li><code class="highlighter-rouge">helmsman --apply -f application/application-prod.yaml</code></li>
</ol>

<h3 id="dss-file-descriptions">DSS File Descriptions</h3>
<p>This sections describes what applications are deployed by each <a href="https://github.com/Praqma/helmsman">helmsman</a> dss file.</p>

<h4 id="cicd_storage_dssyaml">cicd_storage_dss.yaml</h4>
<p>This basically deploys the same services we would need from <a href="https://jfrog.com/">JFrog Artifactory</a></p>
<ul>
  <li>stable/minio</li>
  <li>stable/docker-registry</li>
  <li>stable/chartmuseum</li>
</ul>

<h4 id="cicd_tools_dssyaml">cicd_tools_dss.yaml</h4>
<ul>
  <li>polling-server</li>
  <li>helm-api</li>
  <li>keel-hq/keel</li>
</ul>

<h4 id="application-envyaml">application-[env].yaml</h4>
<ul>
  <li>(the actual application)</li>
</ul>

<p><br /></p>

        </div>

    </div>
</article>
  </body>


  <script src="/assets/js/jquery-3.3.1.min.js"></script>
  <script src="/assets/js/main.js"></script>
  <link rel="stylesheet" href="/assets/css/mobile.css">
</html>