<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google" content="notranslate" />

  <title>Neil Toledo - Primary Gateway Server</title>
  <meta name="description" content="Description:The Primary Gateway Server is the main point that the client connects to first and is responsible for managing authenticated and logged in client...">

  <link rel="icon" href="/assets/images/me.jpg">
  <link rel="shortcut icon" href="/assets/images/me.jpg">
  <link rel="apple-touch-icon" href="/assets/images/me.jpg">

  <link rel="stylesheet" href="/assets/css/rouge.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <!--<link href='https://fonts.googleapis.com/css?family=Lexend+Deca' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Livvic' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>-->
  <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
  <link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet'>
</head>

  <body>
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

    <link rel="stylesheet" href="/assets/css/documentation.css">

    <div id='top-nav-container'>

	<div id='nav-left'>
		<a href='/' class='img-container'> <img id="home-img" src="/assets/images/me.jpg"> </a>
		<h1> 2DMMORPG Documentation </h1>
	</div> 

	<div id='nav-right'>
		<a class="rect-btn" href="/portfolio"> <span>portfolio</span> </a>
		<a class="rect-btn" href="/blog/projects"> <span>blog</span> </a>
		<a class="rect-btn" href="/assets/images/resume.pdf"> <span>resume</span> </a>
	</div>

</div>

<style>

	#top-nav-container {
		display: flex;
		flex-direction: row;

		justify-content: space-between;

	 	max-width: 1280px;
		width: 80vw;

		position: absolute;
		margin: 0px auto;
		top: 32px;
		left: 0px;
		right: 0px;
	}

	#home-img {
		height: 64px;
		width: 64px;
		border-radius: 50%;
		border: 2px black solid;
	}

	#nav-left, #nav-right {
		display: flex;
		flex-direction: row;
	}

	#nav-left > * {
		margin-top: auto;
		margin-bottom: auto;
	}

	#nav-right > * {
		margin-top: auto;
		margin-bottom: auto;
	}

	#nav-left > h1 {
		margin-left: 12px;
		cursor: default;
	}

	.sm-link {
		font-size: 10pt;
		padding: 6px 8px;
	}

	.img-container {
		display: flex;
	}

	.rect-btn {
		width: 128px;
		margin-left: 10px;
		margin-right: 10px;
		border: 2px solid black;
		border-radius: 6px;
		background: white;
		box-shadow: 5px 5px;
		transform: translateY(-5px) translateX(-5px);
		cursor: pointer;
		height: 32px;
		display: flex;
		z-index: 10;
		color: black;
	}

	.rect-btn:hover {
		transition: 0.1s;
		box-shadow: 2px 2px;
		transform: translateY(-2px) translateX(-2px);
		text-decoration: none;
	}
	
	.rect-btn > * {
		margin: auto;
	}


@media (max-width: 1024px) {
	#top-nav-container {
		position: absolute;
	}

	#nav-right {
		display: none;
	}

}

</style>

    <div id="page-container">

        <div id="nav-container">
            <span> Pages </span>
            <ul class='nav-page-list'>

                

                

                

                <!-- get posts without parent -->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <a href="/blog/mmorpg/mmorpg-project-overview"> • Project Overview </a>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <a href="/blog/mmorpg/General-Architecture"> • General Architecture </a>
                    
                
                    
                        <a href="/blog/mmorpg/Scrum-Board"> • Scrum Board [WIP] </a>
                    
                

                <!-- get posts with parent tag -->
                
                    
                    

                    

                    
                    <span> Component Design Documents </span>
                    <ul class='nav-page-list'>
                    
                        
                    
                        
                            <a href="/blog/mmorpg/Game-Client"> • Game Client </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Primary-Gateway-Server"> • Primary Gateway Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Server-Manager"> • Server Manager </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Game-Server-Instance"> • Game Server Instance </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Social-Services-Server"> • Social API Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Account-Data-API"> • Account Data API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Character-Data-API"> • Character Data API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Questing-API"> • Questing API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/CDN-Asset-Server"> • CDN Asset Server </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                
                    
                    

                    

                    
                    <span> Game Design Documents </span>
                    <ul class='nav-page-list'>
                    
                        
                            <a href="/blog/mmorpg/Game-Design-Overview"> • Game Design Overview </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                
                    
                    

                    

                    
                    <span> CI/CD and Infrastructure </span>
                    <ul class='nav-page-list'>
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            <a href="/blog/mmorpg/CICD-Overview"> • Overview </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Configuration-and-Setup"> • Configuration/Setup </a>
                        
                    
                        
                    
                        
                            <a href="/blog/mmorpg/Polling-Server"> • Polling Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Helm-API"> • Helm API </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                


            </ul>
            
        </div>

        <div id="page-content" itemprop="articleBody">
            <header class="post-header">
                <h1 class="post-title" itemprop="name headline">Primary Gateway Server</h1>
                <p class="post-meta"><time datetime="2020-06-14T00:00:00-07:00" itemprop="datePublished">Jun 14, 2020</time></p>
            </header>
            <h4 id="description">Description:</h4>
<p>The Primary Gateway Server is the main point that the client connects to first and is responsible for managing authenticated and logged in clients.  The primary server is also resposnsible for redirecting the client to the proper game server instances.</p>

<p class="column"><a href="/assets/images/mmorpg_pictures/primary-gateway-server-diagram.jpg"><img src="/assets/images/mmorpg_pictures/primary-gateway-server-diagram.jpg" alt="primary_gateway_diagram" style="width: 100%" /></a></p>

<h4 id="features">Features:</h4>
<ul>
  <li>Web Server that serves the landing page and client side code</li>
  <li>Authenticates the Client using Google Identity Platform</li>
  <li>Maintains list of logged in Accounts (via Redis instance)
    <ul>
      <li>also includes information for logged in Character and Character’s current location</li>
      <li>also handles Session Management for authenticated users</li>
    </ul>
  </li>
  <li>Connects Client to the proper Game Server Instance on Log In</li>
</ul>

<h4 id="tools">Tools</h4>
<ul>
  <li>Express.js</li>
  <li>Socket.io
    <ul>
      <li>primarily used to relay game server instance entry points to the Client</li>
    </ul>
  </li>
  <li>Redis
    <ul>
      <li>for Session Management</li>
      <li>for keeping track of logged in Accounts and Characters</li>
    </ul>
  </li>
</ul>

<h4 id="process-flowcharts">Process Flowcharts</h4>

<p class="column"><a href="/assets/images/mmorpg_pictures/architecture-diagram.jpg"><img src="/assets/images/mmorpg_pictures/architecture-diagram.jpg" alt="architecture_diagram" style="width: 100%" /></a></p>

<p class="column"><a href="https://developers.google.com/identity/protocols/images/oauth2/device/flow.png"><img src="https://developers.google.com/identity/protocols/images/oauth2/device/flow.png" alt="login_flow_diagram" style="width: 100%" /></a></p>
<p>The above diagram is the standard process of using Google Idenity Platform to authenticate and log users into an application.</p>

<h5 id="logging-in-a-user">Logging in a User:</h5>
<ul>
  <li>Primary Gateway Server serves website to the User/Client</li>
  <li>User logs in via a Google Auth Link
    <ul>
      <li>User stores the session token in Cache</li>
      <li>Sends a login request to the Primary Gateway Server</li>
    </ul>
  </li>
  <li>Primary Gateway Server authenticates the User and creates a sticky session
    <ul>
      <li>Server makes request to the Account API for a list of the User’s Characters</li>
    </ul>
  </li>
  <li>User sends a request oh which Character they’d like to login as
    <ul>
      <li>User is redirected to the <code class="highlighter-rouge">/game</code> subpath and establishes a websocket connection with the Primary Game Server</li>
    </ul>
  </li>
  <li>Primary Server sends an API request to the Character Data API for selected Character’s last known in game location.
    <ul>
      <li>Primary Server sends a request to the Server Manager for entry point to the specified in-game location’s Game Server Instance</li>
      <li>Primary Server adds an entry/row to the <code class="highlighter-rouge">Logged In Users/Characters</code> Redis database.</li>
      <li>Primary Server pings the Game Server and instructs it to ‘prepare a connection’ with the current Client logging in</li>
      <li>Primary Server responds to the Client with the entry point</li>
    </ul>
  </li>
  <li>Client establishes a websocket connection with the Game Server Instance with a “Logging In” tag
    <ul>
      <li>Client creates a websocket connection with the Social Services Server</li>
      <li>Client requests required game assets from the CDN Assets Server</li>
    </ul>
  </li>
  <li>Game Server adds the Client’s Character Object to the game</li>
</ul>

<h5 id="logging-out-a-user">Logging out a User:</h5>
<ul>
  <li>Client sends logout request to the Game Server Instance, Primary Server and Social Services Server
    <ul>
      <li>OR be signaled on websocket connection disconnect/close</li>
    </ul>
  </li>
  <li>Primary Server removes the User’s <code class="highlighter-rouge">Logged In</code> entry from its Redis database.</li>
</ul>

<p><br /></p>

        </div>

    </div>
</article>
  </body>


  <script src="/assets/js/jquery-3.3.1.min.js"></script>
  <script src="/assets/js/main.js"></script>
  <link rel="stylesheet" href="/assets/css/mobile.css">
</html>