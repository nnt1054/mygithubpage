<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google" content="notranslate" />

  <title>Neil Toledo - Server Manager</title>
  <meta name="description" content="Description:The Server Manager keeps track of the fleet of Game Server Instances and actively maintains a map of in-game locations to its corresponding Game ...">

  <link rel="icon" href="/assets/images/me.jpg">
  <link rel="shortcut icon" href="/assets/images/me.jpg">
  <link rel="apple-touch-icon" href="/assets/images/me.jpg">

  <link rel="stylesheet" href="/assets/css/rouge.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <!--<link href='https://fonts.googleapis.com/css?family=Lexend+Deca' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Livvic' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>-->
  <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
  <link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet'>
</head>

  <body>
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

<!--   <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Server Manager</h1>
    <p class="post-meta"><time datetime="2020-06-13T00:00:00-07:00" itemprop="datePublished">Jun 13, 2020</time></p>
  </header> -->

    <link rel="stylesheet" href="/assets/css/documentation.css">

    <div id='top-nav-container'>

	<div id='nav-left'>
		<a href='/' class='img-container'> <img id="home-img" src="/assets/images/me.jpg"> </a>
		<h1> 2DMMORPG Documentation </h1>
	</div> 

	<div id='nav-right'>
		<a class="rect-btn" href="/portfolio"> <span>portfolio</span> </a>
		<a class="rect-btn" href="/blog/projects"> <span>blog</span> </a>
		<a class="rect-btn" href="/assets/images/resume.pdf"> <span>resume</span> </a>
	</div>

</div>

<style>

	#top-nav-container {
		display: flex;
		flex-direction: row;

		justify-content: space-between;

	 	max-width: 1280px;
		width: 80vw;

		position: absolute;
		margin: 0px auto;
		top: 32px;
		left: 0px;
		right: 0px;
	}

	#home-img {
		height: 64px;
		width: 64px;
		border-radius: 50%;
		border: 2px black solid;
	}

	#nav-left, #nav-right {
		display: flex;
		flex-direction: row;
	}

	#nav-left > * {
		margin-top: auto;
		margin-bottom: auto;
	}

	#nav-right > * {
		margin-top: auto;
		margin-bottom: auto;
	}

	#nav-left > h1 {
		margin-left: 12px;
		cursor: default;
	}

	.sm-link {
		font-size: 10pt;
		padding: 6px 8px;
	}

	.img-container {
		display: flex;
	}

	.rect-btn {
		width: 128px;
		margin-left: 10px;
		margin-right: 10px;
		border: 2px solid black;
		border-radius: 6px;
		background: white;
		box-shadow: 5px 5px;
		transform: translateY(-5px) translateX(-5px);
		cursor: pointer;
		height: 32px;
		display: flex;
		z-index: 10;
		color: black;
	}

	.rect-btn:hover {
		transition: 0.1s;
		box-shadow: 2px 2px;
		transform: translateY(-2px) translateX(-2px);
		text-decoration: none;
	}
	
	.rect-btn > * {
		margin: auto;
	}


@media (max-width: 1024px) {
	#top-nav-container {
		position: absolute;
	}

	#nav-right {
		display: none;
	}

}

</style>

    <div id="page-container">

        <div id="nav-container">
            <span> Pages </span>
            <ul class='nav-page-list'>
<!--                <a href="#"> • Project Overview </a>
                <a href="#"> • Process Documentation </a>
                <a href="#"> • CI/CD and Infrastructure </a>
                <span> Software Architecture </span>
                <ul class='nav-page-list'>
                    <a href="#"> • C4 Models </a>
                    <a href="#"> • Architecture Diagrams </a>
                    <a href="#"> • Flowchart Descriptions </a>
                    <a href="#"> • Game Engine Overview </a>
                </ul>
                <span> Notes </span>
                <ul class='nav-page-list'>
                    <a href="#"> • C4 Models for Software Architecture </a>
                    <a href="#"> • Helm Charts </a>
                </ul> -->

                

                

                

                <!-- get posts without parent -->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <a href="/blog/mmorpg/mmorpg-project-overview"> • Project Overview </a>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <a href="/blog/mmorpg/General-Architecture"> • General Architecture </a>
                    
                

                <!-- get posts with parent tag -->
                
                    
                    

                    

                    
                    <span> Software Architecture </span>
                    <ul class='nav-page-list'>
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            <a href="/blog/mmorpg/C4-Architecture-Models"> • C4 Architecture Models </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Process-Flowcharts"> • Process Flowcharts (Draft) </a>
                        
                    
                        
                    
                    </ul>
                    

                
                    
                    

                    

                    
                    <span> Component Design Documents </span>
                    <ul class='nav-page-list'>
                    
                        
                    
                        
                            <a href="/blog/mmorpg/Game-Client"> • Game Client </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Primary-Gateway-Server"> • Primary Gateway Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Server-Manager"> • Server Manager </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Game-Server-Instance"> • Game Server Instance </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Social-Services-Server"> • Social API Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Account-Data-API"> • Account Data API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Character-Data-API"> • Character Data API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Questing-API"> • Questing API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/CDN-Asset-Server"> • CDN Asset Server </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                
                    
                    

                    

                    
                    <span> Game Design Documents </span>
                    <ul class='nav-page-list'>
                    
                        
                            <a href="/blog/mmorpg/Game-Design-Overview"> • Game Design Overview </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                
                    
                    

                    

                    
                    <span> CI/CD and Infrastructure </span>
                    <ul class='nav-page-list'>
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            <a href="/blog/mmorpg/CICD-Overview"> • Overview </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Configuration-and-Setup"> • Configuration/Setup </a>
                        
                    
                        
                    
                        
                            <a href="/blog/mmorpg/Polling-Server"> • Polling Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Helm-API"> • Helm API </a>
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                


            </ul>
        </div>

        <div id="page-content" itemprop="articleBody">
            <header class="post-header">
                <h1 class="post-title" itemprop="name headline">Server Manager</h1>
                <p class="post-meta"><time datetime="2020-06-13T00:00:00-07:00" itemprop="datePublished">Jun 13, 2020</time></p>
            </header>
            <h4 id="description">Description:</h4>
<p>The Server Manager keeps track of the fleet of Game Server Instances and actively maintains a map of in-game locations to its corresponding Game Server Instance.  The Server Manager is also in charge of manually scaling the number of Game Server Instances up and down as needed.
The Server Manager is important since Game Server Instances are ephemeral are responsible for only their specified in-game location, so a controller/manager service is necessary in order to respond to requests for entry points to the Game Server Instances for specified in-game locations.</p>

<h4 id="features">Features:</h4>
<ul>
  <li>responds to requests for the entrypoint/websocket subpath for a Game Server Instance given an in-game location</li>
  <li>creates/adds new Game Server Instances when necessary and instructs them of which in-game area they’re responsible for</li>
  <li>receives messages from Game Server Instances when the instances want to shutdown due to inactive activity</li>
  <li>periodically pings each Game Server Instance for health checks</li>
</ul>

<h4 id="tools">Tools</h4>
<ul>
  <li>Express.js
    <ul>
      <li>respond to game server instance entry point requests</li>
      <li>listen for game server instance shutdowns</li>
    </ul>
  </li>
  <li>Redis
    <ul>
      <li>for mapping in-game locations to Game Server Instance entry points</li>
    </ul>
  </li>
  <li>Kubernetes API
    <ul>
      <li>used to scale the number of replicas in the Game Servers’ StatefulSet</li>
    </ul>
  </li>
  <li><a href="https://metacontroller.app/">MetaController</a>
    <ul>
      <li>used for creating Service and Ingress objects to expose each Game Server Instances created from the StatefulSet</li>
    </ul>
  </li>
</ul>

<h4 id="process-flowcharts">Process Flowcharts</h4>

<h5 id="responding-to-request-for-a-game-server-instance">Responding to Request for a Game Server Instance</h5>
<ul>
  <li>Receives request for an instance given an in-game map location</li>
  <li>Checks Redis database to see if an instance for the in-game location already exists</li>
  <li>If the instances does not already exist:
    <ul>
      <li>Check if any Game Server Instances are on <code class="highlighter-rouge">standby</code> status
        <ul>
          <li>If none exists, increase the number of replicas for the Game Servers’ StatefulSet</li>
        </ul>
      </li>
      <li>Ping the <code class="highlighter-rouge">standby</code> Game Server Instance and allocate it to the requested in-game location</li>
      <li>The Game Server Instance responds with an OK once they’ve properly configured themselves</li>
      <li>The Server Manger then udpates the mapping in the Redis database</li>
    </ul>
  </li>
  <li>Respond to request with the Game Server Instance’s entry point</li>
</ul>

<h5 id="creating-new-game-server-instance">Creating new Game Server Instance</h5>
<ul>
  <li>Using the Kubernetes API, we increase the number of replicas in the Game Servers’ Stateful Set</li>
  <li>Increasing the replica count will create additional pods with the Game Server Instance Docker Image</li>
  <li>Once the Pod has been created, the Metacontroller DecoratorController will create a corresponding Service and Ingress object for each new Pod</li>
</ul>

<h5 id="responding-to-game-server-instance-shutdown">Responding to Game Server Instance Shutdown</h5>
<ul>
  <li>The Server Manager is informed of a instance shutdown when:
    <ul>
      <li>a Game Server Instances sends a message to the Server Manager of its pending shutdown</li>
      <li>when a Game Server Instances fails to respond to a ping/health check</li>
    </ul>
  </li>
  <li>[TBD] Use Kuberentes API to shutdown the Pod and have the StatefulSet remake the Pod
    <ul>
      <li>When the Pod is restarted, it will restart into a <code class="highlighter-rouge">standby</code> status</li>
    </ul>
  </li>
</ul>

<h5 id="downscaling-the-number-of-game-server-instances">Downscaling the Number of Game Server Instances</h5>
<ul>
  <li>[TBD] Need to figure out a way to transfer active connections from a high indexed Pod to a lower indexed pod when I want to prune inactive Game Server Instances</li>
</ul>

<p><br /></p>

        </div>

    </div>
</article>
  </body>


  <script src="/assets/js/jquery-3.3.1.min.js"></script>
  <script src="/assets/js/main.js"></script>
  <link rel="stylesheet" href="/assets/css/mobile.css">
</html>