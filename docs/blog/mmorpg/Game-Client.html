<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google" content="notranslate" />

  <title>Neil Toledo - Game Client</title>
  <meta name="description" content="Description:The Game Client is the client code running in the User’s browser and will be in charge of maintaining connections with the appropriate services, ...">

  <link rel="icon" href="/assets/images/me.jpg">
  <link rel="shortcut icon" href="/assets/images/me.jpg">
  <link rel="apple-touch-icon" href="/assets/images/me.jpg">

  <link rel="stylesheet" href="/assets/css/rouge.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <!--<link href='https://fonts.googleapis.com/css?family=Lexend+Deca' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Livvic' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>-->
  <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
  <link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet'>
</head>

  <body>
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

<!--   <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Game Client</h1>
    <p class="post-meta"><time datetime="2020-06-15T00:00:00-07:00" itemprop="datePublished">Jun 15, 2020</time></p>
  </header> -->

    <link rel="stylesheet" href="/assets/css/documentation.css">

    <div id='top-nav-container'>

	<div id='nav-left'>
		<a href='/' class='img-container'> <img id="home-img" src="/assets/images/me.jpg"> </a>
		<h1> 2DMMORPG Documentation </h1>
	</div> 

	<div id='nav-right'>
		<a class="rect-btn" href="/portfolio"> <span>portfolio</span> </a>
		<a class="rect-btn" href="/blog/projects"> <span>blog</span> </a>
		<a class="rect-btn" href="/assets/images/resume.pdf"> <span>resume</span> </a>
	</div>

</div>

<style>

	#top-nav-container {
		display: flex;
		flex-direction: row;

		justify-content: space-between;

	 	max-width: 1280px;
		width: 80vw;

		position: absolute;
		margin: 0px auto;
		top: 32px;
		left: 0px;
		right: 0px;
	}

	#home-img {
		height: 64px;
		width: 64px;
		border-radius: 50%;
		border: 2px black solid;
	}

	#nav-left, #nav-right {
		display: flex;
		flex-direction: row;
	}

	#nav-left > * {
		margin-top: auto;
		margin-bottom: auto;
	}

	#nav-right > * {
		margin-top: auto;
		margin-bottom: auto;
	}

	#nav-left > h1 {
		margin-left: 12px;
		cursor: default;
	}

	.sm-link {
		font-size: 10pt;
		padding: 6px 8px;
	}

	.img-container {
		display: flex;
	}

	.rect-btn {
		width: 128px;
		margin-left: 10px;
		margin-right: 10px;
		border: 2px solid black;
		border-radius: 6px;
		background: white;
		box-shadow: 5px 5px;
		transform: translateY(-5px) translateX(-5px);
		cursor: pointer;
		height: 32px;
		display: flex;
		z-index: 10;
		color: black;
	}

	.rect-btn:hover {
		transition: 0.1s;
		box-shadow: 2px 2px;
		transform: translateY(-2px) translateX(-2px);
		text-decoration: none;
	}
	
	.rect-btn > * {
		margin: auto;
	}


@media (max-width: 1024px) {
	#top-nav-container {
		position: absolute;
	}

	#nav-right {
		display: none;
	}

}

</style>

    <div id="page-container">

        <div id="nav-container">
            <span> Pages </span>
            <ul class='nav-page-list'>
<!--                <a href="#"> • Project Overview </a>
                <a href="#"> • Process Documentation </a>
                <a href="#"> • CI/CD and Infrastructure </a>
                <span> Software Architecture </span>
                <ul class='nav-page-list'>
                    <a href="#"> • C4 Models </a>
                    <a href="#"> • Architecture Diagrams </a>
                    <a href="#"> • Flowchart Descriptions </a>
                    <a href="#"> • Game Engine Overview </a>
                </ul>
                <span> Notes </span>
                <ul class='nav-page-list'>
                    <a href="#"> • C4 Models for Software Architecture </a>
                    <a href="#"> • Helm Charts </a>
                </ul> -->

                

                

                

                <!-- get posts without parent -->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <a href="/blog/mmorpg/mmorpg-project-overview"> • Project Overview </a>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <a href="/blog/mmorpg/General-Architecture"> • General Architecture </a>
                    
                

                <!-- get posts with parent tag -->
                
                    
                    

                    

                    
                    <span> Component Design Documents </span>
                    <ul class='nav-page-list'>
                    
                        
                    
                        
                            <a href="/blog/mmorpg/Game-Client"> • Game Client </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Primary-Gateway-Server"> • Primary Gateway Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Server-Manager"> • Server Manager </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Game-Server-Instance"> • Game Server Instance </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Social-Services-Server"> • Social API Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Account-Data-API"> • Account Data API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Character-Data-API"> • Character Data API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Questing-API"> • Questing API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/CDN-Asset-Server"> • CDN Asset Server </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                
                    
                    

                    

                    
                    <span> Game Design Documents </span>
                    <ul class='nav-page-list'>
                    
                        
                            <a href="/blog/mmorpg/Game-Design-Overview"> • Game Design Overview </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                
                    
                    

                    

                    
                    <span> CI/CD and Infrastructure </span>
                    <ul class='nav-page-list'>
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            <a href="/blog/mmorpg/CICD-Overview"> • Overview </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Configuration-and-Setup"> • Configuration/Setup </a>
                        
                    
                        
                    
                        
                            <a href="/blog/mmorpg/Polling-Server"> • Polling Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Helm-API"> • Helm API </a>
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                


            </ul>
            
        </div>

        <div id="page-content" itemprop="articleBody">
            <header class="post-header">
                <h1 class="post-title" itemprop="name headline">Game Client</h1>
                <p class="post-meta"><time datetime="2020-06-15T00:00:00-07:00" itemprop="datePublished">Jun 15, 2020</time></p>
            </header>
            <h4 id="description">Description:</h4>

<p>The Game Client is the client code running in the User’s browser and will be in charge of maintaining connections with the appropriate services, rendering the game and user interface onto the screen and running some game logic with client side prediction.</p>

<p class="column"><a href="/assets/images/mmorpg_pictures/game-client-diagram-01.jpg"><img src="/assets/images/mmorpg_pictures/game-client-diagram-01.jpg" alt="game_client_diagram_01" style="width: 100%" /></a></p>

<p class="column"><a href="/assets/images/mmorpg_pictures/game-client-diagram-02.jpg"><img src="/assets/images/mmorpg_pictures/game-client-diagram-02.jpg" alt="game_client_diagram_02" style="width: 100%" /></a></p>

<h4 id="features">Features:</h4>
<ul>
  <li>authenticates client to google auth and stores session token in cache</li>
  <li>handles websocket connection to the social API server</li>
  <li>handles websocket connection to the Game Server instance</li>
  <li>uses React.js to render User Interface elements</li>
  <li>uses HTML Canvas to render Game Elements</li>
  <li>runs a mini5-engine instance to handle input processing and game update/draw loops.</li>
  <li>loads in and caches game assets</li>
</ul>

<h4 id="tools">Tools:</h4>
<ul>
  <li>mini5-engine
    <ul>
      <li>javascript “game engine” update/draw loop</li>
    </ul>
  </li>
  <li>Socket.io
    <ul>
      <li>maintaining connection with the social API server and Game Server instance</li>
    </ul>
  </li>
  <li>Express.js
    <ul>
      <li>used to create responsive UI elements on top of the HTML5 canvas</li>
      <li>Redux used as a message broker between React components and game engine</li>
    </ul>
  </li>
</ul>

<h4 id="design-considerations">Design Considerations:</h4>

<p>One of the tougher parts of this portion was figuring out how to handle communication between the React UI and the game engine.  I decided on using a separate library (React.js in this case)just for UI elements of the game so I wouldn’t have to reimplement existing UI features with the mini5-engine (note: I’m the author of mini5-engine and it’s still a work in progress.)   I wasn’t sure at first whether or not I should create the React components inside each corresponding Game Object, but I decided against that since it might require specific changes to the mini5-engine to specifically enable this to work.  Since I wanted the UI to be more of an “accessory” to the Game Engine, I decided to split the applicaition into the React “App” and mini5-engine HTML5 Canvas.  In order to make this implementation work however, we need to enable bidirectional communication between the two processes.  There were a few things we needed to account for:</p>

<ul>
  <li>sending information from the GameObjects to the React Component updating state accordingly</li>
  <li>executing a function when interacting with (clicking) a React Component that changes the game state in the game engine.</li>
  <li>considering where to save/store game state</li>
</ul>

<p>A quick reminder that onclick functions must be passed into the React Component when they’re rendered.  After observing how FFXIV handles their HUD, I realize that the existence of all their UI elements are predetermined.  This gave me the idea to just preemptively create all the React components and just have a “display” state that makes them visible and invisible depending on if they’re in use.  With the React components created, we need a way of sending new state information to the React components.  Since it’d be messy to export each components “update” functions and importing them into the GameObject files as well as reusing UI elements with different GameObjects (things like dialogue), I decided against that solution.
What I decided on was using Redux.js as sort of a “message broker” between the two applications.  So React components can subscribe to their respective states in the Redux store and the Game Engine can dispatch updates to it accordingly.  In order to send messages from the React component back to the Game Engine however, the react component would dispatch a change to an action state stored in Redux that the Game Engine would be subscribed to.  The Game Engine would place that action event in an event queue and have it be ingested during the update loop.</p>

<h4 id="process-flowcharts">Process Flowcharts:</h4>

<h5 id="open-quest-dialogue-and-accept-quest">Open Quest Dialogue and Accept Quest:</h5>
<ul>
  <li>User Clicks no NPC</li>
  <li>GameEngine detects the click on the NPC and sends DialogueText object to the ReactUI using Redux</li>
  <li>GameEngine changes Character State to “Reading Dialogue”</li>
  <li>ReactUI DialogueBox receives new state from Redux and renders the text on screen</li>
  <li>User can then click on the DialogueBox to render the next set of text</li>
  <li>After the last DialogueBox, the ReactUI opens a new QuestBox with “Accept” and “Decline” buttons</li>
  <li>User clicks on “Accept” button and that button sends a Redux “state” change from something like “pending” to “accepting”</li>
  <li>The GameEngine (which subscribes itself to the QuestBox state) reads the “Accept” state and appends it to an “Event” queue.
The “Accept” state is then ingested by the appropriate Game Object during its update loop.</li>
</ul>

<h5 id="viewing-inventory-and-using-items">Viewing Inventory and Using Items:</h5>
<ul>
  <li>GameEngine updates ReactUI state to list of inventory items, and action menu/description along with each.</li>
  <li>GameEngine detects “I” input from user to open inventory and sends a “DisplayInventory: true” state change to the ReactUI</li>
  <li>ReactUI then displays the inventory along with hover effects and menu stuff</li>
  <li>If the User clicks on the “Use” button for an Item, the ReactUI sets a “Using” state to Redux along with a “ActiveItem: X” state change to Redux, which is subsequently read by the GameEngine object on update.</li>
</ul>

<p><br /></p>

        </div>

    </div>
</article>
  </body>


  <script src="/assets/js/jquery-3.3.1.min.js"></script>
  <script src="/assets/js/main.js"></script>
  <link rel="stylesheet" href="/assets/css/mobile.css">
</html>