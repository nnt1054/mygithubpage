<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google" content="notranslate" />

  <title>Neil Toledo - Social API Server</title>
  <meta name="description" content="Description:The Social API Server is in charge of faciliating all inter-character communication and interaction.Features:  Maintains Character Search Records...">

  <link rel="icon" href="/assets/images/me.jpg">
  <link rel="shortcut icon" href="/assets/images/me.jpg">
  <link rel="apple-touch-icon" href="/assets/images/me.jpg">

  <link rel="stylesheet" href="/assets/css/rouge.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <!--<link href='https://fonts.googleapis.com/css?family=Lexend+Deca' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Livvic' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet'>-->
  <!--<link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>-->
  <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
  <link href='https://fonts.googleapis.com/css?family=Comfortaa' rel='stylesheet'>
</head>

  <body>
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

<!--   <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Social API Server</h1>
    <p class="post-meta"><time datetime="2020-06-11T00:00:00-07:00" itemprop="datePublished">Jun 11, 2020</time></p>
  </header> -->

    <link rel="stylesheet" href="/assets/css/documentation.css">

    <div id='top-nav-container'>

	<div id='nav-left'>
		<a href='/' class='img-container'> <img id="home-img" src="/assets/images/me.jpg"> </a>
		<h1> 2DMMORPG Documentation </h1>
	</div> 

	<div id='nav-right'>
		<a class="rect-btn" href="/portfolio"> <span>portfolio</span> </a>
		<a class="rect-btn" href="/blog/projects"> <span>blog</span> </a>
		<a class="rect-btn" href="/assets/images/resume.pdf"> <span>resume</span> </a>
	</div>

</div>

<style>

	#top-nav-container {
		display: flex;
		flex-direction: row;

		justify-content: space-between;

	 	max-width: 1280px;
		width: 80vw;

		position: absolute;
		margin: 0px auto;
		top: 32px;
		left: 0px;
		right: 0px;
	}

	#home-img {
		height: 64px;
		width: 64px;
		border-radius: 50%;
		border: 2px black solid;
	}

	#nav-left, #nav-right {
		display: flex;
		flex-direction: row;
	}

	#nav-left > * {
		margin-top: auto;
		margin-bottom: auto;
	}

	#nav-right > * {
		margin-top: auto;
		margin-bottom: auto;
	}

	#nav-left > h1 {
		margin-left: 12px;
		cursor: default;
	}

	.sm-link {
		font-size: 10pt;
		padding: 6px 8px;
	}

	.img-container {
		display: flex;
	}

	.rect-btn {
		width: 128px;
		margin-left: 10px;
		margin-right: 10px;
		border: 2px solid black;
		border-radius: 6px;
		background: white;
		box-shadow: 5px 5px;
		transform: translateY(-5px) translateX(-5px);
		cursor: pointer;
		height: 32px;
		display: flex;
		z-index: 10;
		color: black;
	}

	.rect-btn:hover {
		transition: 0.1s;
		box-shadow: 2px 2px;
		transform: translateY(-2px) translateX(-2px);
		text-decoration: none;
	}
	
	.rect-btn > * {
		margin: auto;
	}


@media (max-width: 1024px) {
	#top-nav-container {
		position: absolute;
	}

	#nav-right {
		display: none;
	}

}

</style>

    <div id="page-container">

        <div id="nav-container">
            <span> Pages </span>
            <ul class='nav-page-list'>
<!--                <a href="#"> • Project Overview </a>
                <a href="#"> • Process Documentation </a>
                <a href="#"> • CI/CD and Infrastructure </a>
                <span> Software Architecture </span>
                <ul class='nav-page-list'>
                    <a href="#"> • C4 Models </a>
                    <a href="#"> • Architecture Diagrams </a>
                    <a href="#"> • Flowchart Descriptions </a>
                    <a href="#"> • Game Engine Overview </a>
                </ul>
                <span> Notes </span>
                <ul class='nav-page-list'>
                    <a href="#"> • C4 Models for Software Architecture </a>
                    <a href="#"> • Helm Charts </a>
                </ul> -->

                

                

                

                <!-- get posts without parent -->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <a href="/blog/mmorpg/mmorpg-project-overview"> • Project Overview </a>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <a href="/blog/mmorpg/General-Architecture"> • General Architecture </a>
                    
                

                <!-- get posts with parent tag -->
                
                    
                    

                    

                    
                    <span> Component Design Documents </span>
                    <ul class='nav-page-list'>
                    
                        
                    
                        
                            <a href="/blog/mmorpg/Game-Client"> • Game Client </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Primary-Gateway-Server"> • Primary Gateway Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Server-Manager"> • Server Manager </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Game-Server-Instance"> • Game Server Instance </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Social-Services-Server"> • Social API Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Account-Data-API"> • Account Data API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Character-Data-API"> • Character Data API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Questing-API"> • Questing API </a>
                        
                    
                        
                            <a href="/blog/mmorpg/CDN-Asset-Server"> • CDN Asset Server </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                
                    
                    

                    

                    
                    <span> Game Design Documents </span>
                    <ul class='nav-page-list'>
                    
                        
                            <a href="/blog/mmorpg/Game-Design-Overview"> • Game Design Overview </a>
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                
                    
                    

                    

                    
                    <span> CI/CD and Infrastructure </span>
                    <ul class='nav-page-list'>
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                    
                        
                            <a href="/blog/mmorpg/CICD-Overview"> • Overview </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Configuration-and-Setup"> • Configuration/Setup </a>
                        
                    
                        
                    
                        
                            <a href="/blog/mmorpg/Polling-Server"> • Polling Server </a>
                        
                    
                        
                            <a href="/blog/mmorpg/Helm-API"> • Helm API </a>
                        
                    
                        
                    
                        
                    
                        
                    
                    </ul>
                    

                


            </ul>
            
        </div>

        <div id="page-content" itemprop="articleBody">
            <header class="post-header">
                <h1 class="post-title" itemprop="name headline">Social API Server</h1>
                <p class="post-meta"><time datetime="2020-06-11T00:00:00-07:00" itemprop="datePublished">Jun 11, 2020</time></p>
            </header>
            <h4 id="description">Description:</h4>
<p>The Social API Server is in charge of faciliating all inter-character communication and interaction.</p>

<p class="column"><a href="/assets/images/mmorpg_pictures/architecture-diagram.jpg"><img src="/assets/images/mmorpg_pictures/architecture-diagram.jpg" alt="architecture_diagram" style="width: 100%" /></a></p>

<h4 id="features">Features:</h4>
<ul>
  <li>Maintains Character Search Records for currently Logged In Characters
    <ul>
      <li>Name, Log In Status, Current Location, Current Class/Job, Guild/Company</li>
      <li>Note: There is a difference between Character Search Records and Charcter Data.  Search Records only include a sparse amount of information about the Character but does include their current location.</li>
    </ul>
  </li>
  <li>Handles Non-Proximity based Chatting
    <ul>
      <li>Includes Direct Messages, Party Chat, Guild Chat, Linkshells</li>
      <li>Does NOT include Local Chat</li>
    </ul>
  </li>
  <li>Handles Party System and Guild System</li>
</ul>

<h4 id="tools">Tools:</h4>
<ul>
  <li>Express.js</li>
  <li>Socket.io
    <ul>
      <li>Redis-Adapter</li>
    </ul>
  </li>
  <li>Redis</li>
</ul>

<p class="column"><a href="https://miro.medium.com/max/5352/1*eorR6ciIzJ_juxugxAfksQ.png"><img src="https://miro.medium.com/max/5352/1*eorR6ciIzJ_juxugxAfksQ.png" alt="redis-adapter" style="width: 100%" /></a></p>
<p>The diagram above is an example of how the Socket.io <a href="https://github.com/socketio/socket.io-redis">redis-adapter</a> will function and broadcast messages between different running instances.</p>

<h4 id="process-flowcharts">Process Flowcharts:</h4>

<h5 id="sending-a-direct-message">Sending a Direct Message</h5>
<ul>
  <li>When a Character logs in and connects to the Game Server, the Client also creates a websocket connection with the Social API Server</li>
  <li>On Client connect, the client joins a Socket.io room name “DM:@charactername”
    <ul>
      <li>The Client also joins additional Socket.io room: “guild:@guildname”, “linkshell:@linkshellID”</li>
      <li>On forming a party, the Client will also subscribe to a room; “party:@partyID”</li>
    </ul>
  </li>
  <li>Client sends a Socket.io message to the Social API Service with the string: “/dm @lambseel here is my message”</li>
  <li>The Social API Service will parse the message to: “/dm”, “@lambseel”, “here is my message”</li>
  <li>Social API Server will check if the room “dm:lambseel” exists
    <ul>
      <li>If the room does not exist, respond back to the Client that the user is offline</li>
    </ul>
  </li>
  <li>Social API Server will make a call: <code class="highlighter-rouge">socket.to(dm:lambseel, "here is my message")</code>
    <ul>
      <li>redis-adapter publishes message events to all Social API Server pods</li>
      <li>If a Social API Server Pod has a socket connection thats subscribed to a “dm:lambseel” room, then that Pod sends a message through that socket to User lambseel’s chat Client.</li>
    </ul>
  </li>
</ul>

<h5 id="proximity-chat-game-server-instance">Proximity Chat (Game Server Instance):</h5>
<ul>
  <li>Client sends a chat message to the Game Server Instance</li>
  <li>Game Server Instance emits that message to all of its active websocket connections</li>
</ul>

<h5 id="getting-character-search-record">Getting Character Search Record</h5>
<ul>
  <li>on Client connect, the Social API Server will make an API request to the Character Data API</li>
  <li>the Social API Server will then create a Search Record Entry of the Character’s Data</li>
</ul>

<h5 id="udpating-location-in-character-search-record">Udpating Location in Character Search Record</h5>
<ul>
  <li>on Client connect to a Game Server Instance, the Game Server Instance will send an API request to the Social API Server with the Character’s new location</li>
  <li>the Social API Server updates the Search Record’s Location field for that Character in the Redis database</li>
</ul>

<h5 id="getting-status-of-characters-on-friends-list">Getting Status of Characters on Friends List</h5>
<ul>
  <li>the Client should have their Friends List cache/stored locally</li>
  <li>the Client sends a GET API request to the Social API Server with a list of Characters on their Friends List</li>
  <li>the Social API Server just grabs the Search Records for each Character in the list
    <ul>
      <li>If the Character is not in the Search Recrods, then they are assumed to be offline</li>
    </ul>
  </li>
  <li>the Social API Server responds back to the client with the results</li>
</ul>

<p><br /></p>

        </div>

    </div>
</article>
  </body>


  <script src="/assets/js/jquery-3.3.1.min.js"></script>
  <script src="/assets/js/main.js"></script>
  <link rel="stylesheet" href="/assets/css/mobile.css">
</html>